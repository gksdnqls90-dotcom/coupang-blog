<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>icbhplus Â· ì¿ íŒ¡ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ </title>
  <meta name="description" content="ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ì¶”ì²œ ìƒí’ˆ í‚¤ì›Œë“œ ëª¨ìŒ" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      margin: 0;
      padding: 32px;
      background: #020817;
      color: #e5e7eb;
    }

    header.wrap {
      max-width: 1080px;
      margin: 0 auto 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    .topbar {
      font-size: 11px;
      color: #64748b;
      margin-bottom: 4px;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 28px;
    }

    p.sub {
      margin: 0;
      font-size: 13px;
      color: #9ca3af;
    }

    .admin-link {
      font-size: 12px;
      color: #a5b4fc;
      text-decoration: none;
      border: 1px solid rgba(129, 140, 248, 0.5);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      white-space: nowrap;
    }

    .admin-link:hover {
      background: rgba(79, 70, 229, 0.3);
    }

    /* ê²€ìƒ‰ ì˜ì—­ */
    .search-wrap {
      max-width: 1080px;
      margin: 0 auto 18px;
    }

    .search-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid #1e293b;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
      box-sizing: border-box;
      outline: none;
    }

    .search-input::placeholder {
      color: #6b7280;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
      max-width: 1080px;
      margin: 0 auto;
    }

    .card {
      position: relative;
      background: #111827;
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(148, 163, 253, 0.16);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.55);
      transition: all 0.18s ease;
      cursor: pointer;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 24px 55px rgba(15, 23, 42, 0.9);
      border-color: #38bdf8;
    }

    .card-title {
      font-size: 16px;
      margin: 0 0 6px;
      color: #e5e7eb;
    }

    .card-link {
      font-size: 13px;
      color: #38bdf8;
      text-decoration: none;
    }

    .badge {
      display: inline-block;
      margin-top: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(56, 189, 248, 0.12);
      color: #38bdf8;
    }

    .empty {
      max-width: 1080px;
      margin: 40px auto;
      font-size: 13px;
      color: #9ca3af;
    }
  </style>
</head>

<body>
  <header class="wrap">
    <div>
      <div class="topbar">icbhplus Â· ì¿ íŒ¡ ì¶”ì²œ í¬í„¸</div>
      <h1>ì¿ íŒ¡ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸</h1>
      <p class="sub">â€œìš”ì¦˜ ì¸ê¸° í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•´ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.â€</p>
    </div>
    <a href="/admin.html" class="admin-link">ê´€ë¦¬ì í˜ì´ì§€ â†’</a>
  </header>

  <!-- ê²€ìƒ‰ ì˜ì—­ -->
  <div class="search-wrap">
    <input id="searchInput" class="search-input" type="text" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰ (ì˜ˆ: ì˜ì–‘ì œ, ê³µê¸°ì²­ì •ê¸°, ë…¸íŠ¸ë¶...)" />
  </div>

  <main class="grid" id="cards"></main>
  <div class="empty" id="emptyMsg" style="display:none;"></div>

  <script>
    const API_BASE = '/.netlify/functions';
    const cardsEl = document.getElementById('cards');
    const emptyMsgEl = document.getElementById('emptyMsg');
    const searchInput = document.getElementById('searchInput');

    let allKeywords = [];
    let currentQuery = '';

    function createCard(item) {
      const article = document.createElement('article');
      article.className = 'card';

      const linkHref = `/live/${item.slug}`;

      article.innerHTML = `
        <div class="card-title">${item.keyword}</div>
        <a class="card-link" href="${linkHref}" target="_blank" rel="noopener noreferrer">
          ë°”ë¡œ ë³´ê¸° â†’
        </a>
        <div class="badge">ì‹¤ì‹œê°„ ìƒì„±</div>
      `;

      article.addEventListener('click', (e) => {
        if (e.target.tagName.toLowerCase() !== 'a') {
          window.open(linkHref, '_blank');
        }
      });

      return article;
    }

    function renderList(list) {
      cardsEl.innerHTML = '';
      list.forEach((item) => {
        cardsEl.appendChild(createCard(item));
      });
    }

    function applyFilter() {
      const q = currentQuery.trim();

      if (!allKeywords.length) {
        emptyMsgEl.style.display = 'block';
        emptyMsgEl.textContent = 'ë“±ë¡ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì²« í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ ë³´ì„¸ìš”.';
        return;
      }

      if (!q) {
        // ê²€ìƒ‰ì–´ ì—†ì„ ë•Œ ì „ì²´ ëª©ë¡
        renderList(allKeywords);
        emptyMsgEl.style.display = 'none';
        return;
      }

      const lowerQ = q.toLowerCase();
      const filtered = allKeywords.filter((item) =>
        (item.keyword || '').toLowerCase().includes(lowerQ)
      );

      if (filtered.length === 0) {
        cardsEl.innerHTML = '';
        emptyMsgEl.style.display = 'block';
        emptyMsgEl.textContent = `"${q}" ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.`;
      } else {
        emptyMsgEl.style.display = 'none';
        renderList(filtered);
      }
    }

    async function loadKeywords() {
      try {
        const res = await fetch(`${API_BASE}/getKeywords`);
        const list = await res.json();
        allKeywords = Array.isArray(list) ? list : [];
        applyFilter();
      } catch (e) {
        console.error(e);
        allKeywords = [];
        cardsEl.innerHTML = '';
        emptyMsgEl.style.display = 'block';
        emptyMsgEl.textContent = 'í‚¤ì›Œë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      }
    }

    // ê²€ìƒ‰ì°½ ì…ë ¥ ì´ë²¤íŠ¸
    searchInput.addEventListener('input', (e) => {
      currentQuery = e.target.value;
      applyFilter();
    });

    // URL ?q=ì˜ì–‘ì œ ì´ëŸ° ì‹ìœ¼ë¡œ ë“¤ì–´ì˜¨ ì´ˆê¸° ê²€ìƒ‰ì–´ ì²˜ë¦¬
    (function initQueryFromURL() {
      const params = new URLSearchParams(window.location.search);
      const q = params.get('q') || '';
      if (q) {
        currentQuery = q;
        searchInput.value = q;
        return;
      }

      // ğŸ‘‡ ì¶”ê°€ / ìˆ˜ì •ëœ ë¶€ë¶„: /live/ ë¡œ ì‹œì‘í•˜ë©´ ë¬´ì‹œ
      const path = window.location.pathname || '/';
      if (!path.startsWith('/live/')) {
        // /ì˜ì–‘ì œ, /ë‹¤ì´ì–´íŠ¸-í›„ê¸° ì´ëŸ° ê±¸ í‚¤ì›Œë“œë¡œ ì‚¬ìš©
        const segment = decodeURIComponent(path.replace(/^\/+/, '').split('/')[0]);
        if (segment) {
          currentQuery = segment;
          searchInput.value = segment;
        }
      }
    })();


    // ë°ì´í„° ë¡œë”©
    loadKeywords();
  </script>
</body>

</html>