// netlify/functions/livePost.js
// âœ… ë¬´ë£Œ ë²„ì „: ì¿ íŒ¡ ìƒí’ˆ + ê·œì¹™ ê¸°ë°˜ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ + ì„¤ëª…ë¬¸ + FAQ + í•´ì‹œíƒœê·¸ ìë™ ìƒì„±

const CoupangPartners = require('../../CoupangPartners');
const { getStore, connectLambda } = require('@netlify/blobs');

const coupang = new CoupangPartners();

// ---------------------------
// 1. í‚¤ì›Œë“œ -> Blobs ì—ì„œ ì¡°íšŒ
// ---------------------------
async function getKeywordFromStore(slug) {
  const store = getStore({
    name: 'keywords',
    siteID: process.env.NETLIFY_SITE_ID,
    token: process.env.NETLIFY_API_TOKEN,
  });

  let list = [];
  try {
    list = (await store.get('list', { type: 'json' })) || [];
  } catch (e) {
    console.error('[livePost] blobs get error:', e);
    list = [];
  }

  const hit = list.find((item) => item.slug === slug);
  return hit ? hit.keyword : decodeURIComponent(slug).replace(/-/g, ' ');
}

// ---------------------------
// 2. ì—°ê´€ í‚¤ì›Œë“œ(í•´ì‹œíƒœê·¸ìš©) ìƒì„±
// ---------------------------
function generateRelatedKeywords(keyword) {
  if (!keyword) return [];

  let base = keyword.trim();
  // "ì¶”ì²œ/ìˆœìœ„/ê°€ì„±ë¹„/í›„ê¸°" ê°™ì€ ê¼¬ë¦¬ ì œê±°
  base = base
    .replace(
      /\s*(ì¶”ì²œ|ìˆœìœ„|ê°€ì„±ë¹„|ë¹„êµ|í›„ê¸°|ë¦¬ë·°|TOP ?\d+|top ?\d+)\s*$/i,
      '',
    )
    .trim();
  if (!base) base = keyword.trim();

  const variants = [
    base,
    `${base} ì¶”ì²œ`,
    `${base} ê°€ì„±ë¹„`,
    `${base} ìˆœìœ„`,
    `${base} í›„ê¸°`,
    `${base} ì‚¬ìš© í›„ê¸°`,
    `${base} ì¸ê¸° ìƒí’ˆ`,
    `${base} ì¿ íŒ¡`,
    `${base} í• ì¸`,
    `${base} ë² ìŠ¤íŠ¸`,
  ];

  const uniq = [];
  const seen = new Set();
  for (const v of variants) {
    const t = v.trim();
    if (!t || seen.has(t)) continue;
    seen.add(t);
    uniq.push(t);
  }
  return uniq.slice(0, 10);
}

// ---------------------------
// 3. ì¹´í…Œê³ ë¦¬ íŒ¨í„´ (500ê°œ ì´ìƒ í‚¤ì›Œë“œ íŒ¨í„´ ë¶„ì‚°)
// ---------------------------

const CATEGORY_PATTERNS = {
  mobile: [
    'íœ´ëŒ€í°', 'ìŠ¤ë§ˆíŠ¸í°', 'í•¸ë“œí°', 'ì•„ì´í°', 'ê°¤ëŸ­ì‹œ',
    'ì¼€ì´ìŠ¤', 'ë²”í¼ì¼€ì´ìŠ¤', 'ì ¤ë¦¬ì¼€ì´ìŠ¤', 'í•˜ë“œì¼€ì´ìŠ¤',
    'ë³´í˜¸í•„ë¦„', 'ê°•í™”ìœ ë¦¬', 'ì•¡ì •ë³´í˜¸', 'ì•¡ì •ë³´í˜¸í•„ë¦„',
    'ì¶©ì „ê¸°', 'ê³ ì†ì¶©ì „ê¸°', 'ë¬´ì„ ì¶©ì „', 'ë¬´ì„ ì¶©ì „ê¸°', 'ë³´ì¡°ë°°í„°ë¦¬',
    'ì¶©ì „ì¼€ì´ë¸”', 'cíƒ€ì… ì¼€ì´ë¸”', 'ë¼ì´íŠ¸ë‹ ì¼€ì´ë¸”',
    'ì—ì–´íŒŸ', 'ë²„ì¦ˆ', 'ë¸”ë£¨íˆ¬ìŠ¤ ì´ì–´í°', 'í´ë“œ ì¼€ì´ìŠ¤', 'í”Œë¦½ ì¼€ì´ìŠ¤',
    'ì¹´ë©”ë¼ ë Œì¦ˆ ë³´í˜¸', 'ë§ì¼€ì´ìŠ¤', 'ì¹´ë“œìˆ˜ë‚© ì¼€ì´ìŠ¤',
  ],
  computer: [
    'ë…¸íŠ¸ë¶', 'ë©íƒ‘', 'ê²Œì´ë° ë…¸íŠ¸ë¶', 'ë§¥ë¶',
    'ë°ìŠ¤í¬íƒ‘', 'ë³¸ì²´', 'pc', 'ê²Œì´ë° pc',
    'ëª¨ë‹ˆí„°', 'ê²Œì´ë° ëª¨ë‹ˆí„°', 'ì»¤ë¸Œë“œ ëª¨ë‹ˆí„°', '27ì¸ì¹˜', '32ì¸ì¹˜',
    'í‚¤ë³´ë“œ', 'ê¸°ê³„ì‹ í‚¤ë³´ë“œ', 'ë¬´ì„  í‚¤ë³´ë“œ', 'ë§ˆìš°ìŠ¤', 'ë²„í‹°ì»¬ ë§ˆìš°ìŠ¤',
    'ë§ˆìš°ìŠ¤íŒ¨ë“œ', 'ì†ëª©íŒ¨ë“œ', 'ë…¸íŠ¸ë¶ ê±°ì¹˜ëŒ€', 'ì¿¨ë§íŒ¨ë“œ',
    'usb í—ˆë¸Œ', 'í—ˆë¸Œ', 'sdë¦¬ë”ê¸°', 'ì €ì¥ì¥ì¹˜', 'ì™¸ì¥í•˜ë“œ', 'ssd',
    'ê³µìœ ê¸°', 'ëœì¹´ë“œ', 'iptime', 'ë¼ìš°í„°',
  ],
  appliance: [
    'ì²­ì†Œê¸°', 'ë¬´ì„ ì²­ì†Œê¸°', 'ìœ ì„ ì²­ì†Œê¸°', 'ë¡œë´‡ì²­ì†Œê¸°',
    'ê³µê¸°ì²­ì •ê¸°', 'ê°€ìŠµê¸°', 'ì œìŠµê¸°', 'ì—ì–´ì»¨', 'ì„ í’ê¸°', 'ì¨í˜ë ˆì´í„°',
    'ì „ê¸°í¬íŠ¸', 'ì „ê¸°ì£¼ì „ì', 'ì „ê¸°ë°¥ì†¥', 'ì••ë ¥ë°¥ì†¥',
    'ì „ìë ˆì¸ì§€', 'ì˜¤ë¸', 'ì˜¤ë¸ë Œì§€', 'ì—ì–´í”„ë¼ì´ì–´',
    'íˆí„°', 'ì „ê¸°ë‚œë¡œ', 'ì˜¨í’ê¸°', 'ì „ê¸°ì¥íŒ', 'ì˜¨ìˆ˜ë§¤íŠ¸',
    'ì„¸íƒê¸°', 'ê±´ì¡°ê¸°', 'ì‹ê¸°ì„¸ì²™ê¸°', 'ì •ìˆ˜ê¸°',
  ],
  kitchen: [
    'ëƒ„ë¹„', 'í›„ë¼ì´íŒ¬', 'í”„ë¼ì´íŒ¬', 'ì›íŒ¬', 'ê¶ì¤‘íŒ¬',
    'ì¸ë•ì…˜', 'ì¸ë•ì…˜ í”„ë¼ì´íŒ¬', 'ì••ë ¥ì†¥',
    'ì¹¼', 'ì‹ë„', 'ì£¼ë°©ì¹¼', 'ì¹¼ë¸”ëŸ­', 'ë„ë§ˆ',
    'ì£¼ë°©ê°€ìœ„', 'ì¡°ë¦¬ë„êµ¬', 'êµ­ì', 'ì£¼ê±±', 'ë’¤ì§‘ê°œ',
    'ê·¸ë¦‡', 'ì ‘ì‹œ', 'ì‹ê¸°', 'ë¨¸ê·¸ì»µ', 'ìœ ë¦¬ì»µ',
    'ë°€íìš©ê¸°', 'ë½ì•¤ë½', 'ê¸€ë¼ìŠ¤ë½', 'ë°˜ì°¬í†µ',
    'ì»¤í”¼ë¨¸ì‹ ', 'ì»¤í”¼ë©”ì´ì»¤', 'ì „ë™ ê·¸ë¼ì¸ë”', 'ë“œë¦½í¬íŠ¸',
    'ë„ì‹œë½í†µ', 'ë„ì‹œë½ ê°€ë°©', 'ë³´ì˜¨ë„ì‹œë½', 'í…€ë¸”ëŸ¬', 'ë³´ì˜¨ë³‘',
    'ì‹ê¸°ê±´ì¡°ëŒ€', 'ì‹±í¬ëŒ€ ì„ ë°˜', 'ìˆ˜ì €í†µ',
  ],
  baby: [
    'ì•„ê¸°', 'ì‹ ìƒì•„', 'ìœ¡ì•„', 'ìœ ì•„', 'ë² ì´ë¹„',
    'ê¸°ì €ê·€', 'ê¸°ì €ê·€í¬ë¦¼', 'ë¬¼í‹°ìŠˆ', 'ì—‰ë©ì´ ë¬¼í‹°ìŠˆ',
    'ì –ë³‘', 'ì –ë³‘ì„¸ì •ì œ', 'ì –ë³‘ ì†Œë…ê¸°',
    'ë¶„ìœ ', 'ë¶„ìœ í†µ', 'ì´ìœ ì‹', 'ì´ìœ ì‹ ìš©ê¸°', 'í„±ë°›ì´',
    'ìœ ëª¨ì°¨', 'ì¹´ì‹œíŠ¸', 'ì•„ê¸°ë ', 'í™ì‹œíŠ¸',
    'ì†ìˆ˜ê±´', 'ì†ì‹¸ê°œ', 'ë°¤ë¶€ ì†ìˆ˜ê±´',
    'ì•„ê¸°ìš•ì¡°', 'ëª©íŠœë¸Œ', 'ê¸°ì €ê·€ê°ˆì´ ë§¤íŠ¸',
  ],
  beauty: [
    'ì„ í¬ë¦¼', 'ìì™¸ì„ ì°¨ë‹¨ì œ', 'ì„ ë¸”ë¡',
    'ì¿ ì…˜', 'íŒŒìš´ë°ì´ì…˜', 'ë¹„ë¹„í¬ë¦¼', 'ì»¨ì‹¤ëŸ¬',
    'ìŠ¤í‚¨', 'í† ë„ˆ', 'ì—ì„¼ìŠ¤', 'ì„¸ëŸ¼', 'ì•°í”Œ', 'ì•„ì´í¬ë¦¼',
    'ìˆ˜ë¶„í¬ë¦¼', 'ì˜ì–‘í¬ë¦¼', 'ë‚˜ì´íŠ¸í¬ë¦¼',
    'ë¦½ë°¤', 'ë¦½ìŠ¤í‹±', 'í‹´íŠ¸', 'ê¸€ë¡œìŠ¤',
    'í´ë Œì§•í¼', 'í´ë Œì§•ì˜¤ì¼', 'í´ë Œì§•ì›Œí„°',
    'ë§ˆìŠ¤í¬íŒ©', 'ì‹œíŠ¸íŒ©', 'í•„ì˜¤í”„íŒ©',
    'ìƒ´í‘¸', 'ë¦°ìŠ¤', 'íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸', 'í—¤ì–´ì˜¤ì¼', 'í—¤ì–´ì—ì„¼ìŠ¤',
    'ë°”ë””ì›Œì‹œ', 'ë°”ë””ë¡œì…˜', 'ë°”ë””ì˜¤ì¼', 'ë°ì˜¤ë“œë€íŠ¸',
    'í–¥ìˆ˜', 'ë°”ë””ë¯¸ìŠ¤íŠ¸',
  ],
  fitness: [
    'ìš”ê°€ë§¤íŠ¸', 'ìš”ê°€ ë§¤íŠ¸', 'í”¼íŠ¸ë‹ˆìŠ¤', 'í—¬ìŠ¤',
    'ë¤ë²¨', 'ë°”ë²¨', 'í‘¸ì‰¬ì—…ë°”', 'ì¼€í‹€ë²¨',
    'í¼ë¡¤ëŸ¬', 'ìŠ¤íŠ¸ë ˆì¹­ ë°´ë“œ', 'íƒ„ë ¥ë°´ë“œ', 'ì €í•­ë°´ë“œ',
    'í’€ì—…ë°”', 'ì² ë´‰', 'í„±ê±¸ì´', 'í™ˆíŠ¸',
    'ì‹¤ë‚´ ìì „ê±°', 'ëŸ¬ë‹ë¨¸ì‹ ', 'ëŸ°ë‹ë¨¸ì‹ ',
    'í—¬ìŠ¤ì¥ ì¥ê°‘', 'ë¦¬í”„íŒ… ìŠ¤íŠ¸ë©', 'í—¬ìŠ¤ ë²¨íŠ¸',
    'ì›Œí‚¹í™”', 'ëŸ¬ë‹í™”', 'íŠ¸ë ˆì´ë‹ë³µ', 'ìš´ë™ë³µ',
  ],
  auto: [
    'ìë™ì°¨', 'ì°¨ëŸ‰ìš©', 'ì¹´ìš©í’ˆ', 'ì¹´ì•…ì„¸ì„œë¦¬',
    'ë¸”ë™ë°•ìŠ¤', 'ë„¤ë¹„ê²Œì´ì…˜', 'í•˜ì´íŒ¨ìŠ¤',
    'ë°œë§¤íŠ¸', 'ì½”ì¼ë§¤íŠ¸', 'íŠ¸ë í¬ ë§¤íŠ¸',
    'í•¸ë“¤ì»¤ë²„', 'ì‹œíŠ¸ì»¤ë²„', 'ëª©ì¿ ì…˜', 'í—ˆë¦¬ì¿ ì…˜',
    'ì£¼ì°¨ë²ˆí˜¸íŒ', 'ë°©í–¥ì œ', 'ë””í“¨ì €', 'íƒˆì·¨ì œ',
    'ì„¸ì°¨ìš©í’ˆ', 'ì„¸ì°¨ íƒ€ì›”', 'ë¬¼ì™ìŠ¤', 'íƒ€ì´ì–´ ê´‘íƒì œ',
    'ì°¨ë°•', 'ì°¨ë°• ë§¤íŠ¸', 'ì°¨ë°• ì—ì–´ë§¤íŠ¸',
  ],
  toy: [
    'ë ˆê³ ', 'lego', 'ë¸Œë¦­', 'ë¸”ë¡ì¥ë‚œê°',
    'í”„ë¼ëª¨ë¸', 'ê±´ë‹´', 'ê±´í”„ë¼', 'í”¼ê·œì–´',
    'ë¯¸ë‹ˆì¹´', 'rcì¹´', 'ë¼ë””ì˜¤ì»¨íŠ¸ë¡¤', 'ë“œë¡ ',
    'í¼ì¦', 'ì§ì†Œí¼ì¦', 'ë³´ë“œê²Œì„', 'ì  ê°€', 'í• ë¦¬ê°ˆë¦¬',
    'ì¸í˜•', 'ë´‰ì œì¸í˜•', 'ì ¤ë¦¬ìº£', 'ê³°ì¸í˜•',
    'ìŠ¬ë¼ì„', 'í‚¤ë„¤í‹± ìƒŒë“œ', 'í”Œë ˆì´ë„',
    'ë¬¼ì´', 'ë¹„ì¹˜ë³¼', 'ì™„êµ¬',
  ],
  fashion: [
    'í‹°ì…”ì¸ ', 'ë§¨íˆ¬ë§¨', 'í›„ë“œí‹°', 'ì…”ì¸ ', 'ë¸”ë¼ìš°ìŠ¤',
    'ì²­ë°”ì§€', 'ìŠ¬ë™ìŠ¤', 'ì¡°ê±°íŒ¬ì¸ ', 'íŠ¸ë ˆì´ë‹ë³µ',
    'íŒ¨ë”©', 'ì½”íŠ¸', 'ì í¼', 'ë°”ëŒë§‰ì´',
    'ì›í”¼ìŠ¤', 'ì¹˜ë§ˆ', 'ìŠ¤ì»¤íŠ¸',
    'ìš´ë™í™”', 'ìŠ¤ë‹ˆì»¤ì¦ˆ', 'êµ¬ë‘', 'ìƒŒë“¤', 'ìŠ¬ë¦¬í¼',
    'ëª¨ì', 'ìº¡ëª¨ì', 'ë¹„ë‹ˆ', 'ë²„í‚·í–‡',
    'ê°€ë°©', 'ë°±íŒ©', 'í¬ë¡œìŠ¤ë°±', 'í† íŠ¸ë°±', 'ì—ì½”ë°±',
    'ì–‘ë§', 'ìŠ¤íƒ€í‚¹', 'ë ˆê¹…ìŠ¤',
  ],
  health: [
    'ì˜ì–‘ì œ', 'ë¹„íƒ€ë¯¼', 'ë©€í‹°ë¹„íƒ€ë¯¼',
    'ì˜¤ë©”ê°€3', 'í”¼ì‰¬ì˜¤ì¼', 'ì½”ì—”ìì„q10',
    'ìœ ì‚°ê· ', 'í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤', 'í”„ë¦¬ë°”ì´ì˜¤í‹±ìŠ¤',
    'í™ì‚¼', 'ì¸ì‚¼', 'ë…¹ìš©', 'ì½œë¼ê²',
    'ë‹¨ë°±ì§ˆ ë³´ì¶©ì œ', 'í”„ë¡œí‹´', 'ì›¨ì´', 'bcaa',
    'ë‹¤ì´ì–´íŠ¸ ë³´ì¡°ì œ', 'cla', 'ê°€ë¥´ì‹œë‹ˆì•„',
    'ë§ˆê·¸ë„¤ìŠ˜', 'ì•„ì—°', 'ì² ë¶„', 'ì—½ì‚°',
  ],
  pet: [
    'ê°•ì•„ì§€', 'ê³ ì–‘ì´', 'ë°˜ë ¤ë™ë¬¼',
    'ì‚¬ë£Œ', 'ê°„ì‹', 'íŠ¸ë¦¿',
    'ê³ ì–‘ì´ëª¨ë˜', 'ë°°ë³€íŒ¨ë“œ',
    'í•˜ë„¤ìŠ¤', 'ëª©ì¤„', 'ë¦¬ë“œì¤„',
    'ìº£íƒ€ì›Œ', 'ìŠ¤í¬ë˜ì³',
    'í« ìœ ëª¨ì°¨', 'í«ì¹´ì‹œíŠ¸',
    'í«ìƒ´í‘¸', 'í«íƒ€ì›”', 'ë°œë°”ë‹¥ë°¤',
  ],
  furniture: [
    'ì±…ìƒ', 'ì»´í“¨í„°ì±…ìƒ', 'ì‹íƒ', 'í…Œì´ë¸”',
    'ì˜ì', 'ê²Œì´ë° ì˜ì', 'ì‚¬ë¬´ìš© ì˜ì',
    'ì†ŒíŒŒ', 'ë¦¬í´ë¼ì´ë„ˆ', 'ì•ˆë½ì˜ì',
    'ì¹¨ëŒ€í”„ë ˆì„', 'ìˆ˜ë‚©ì¥', 'ì˜·ì¥', 'ì„œëì¥',
    'í–‰ê±°', 'ì„ ë°˜', 'ìˆ˜ë‚©ë°•ìŠ¤',
    'ì±…ì¥', 'ì„ ë°˜ì¥', 'tvì¥', 'tvë‹¤ì´',
  ],
  interior: [
    'ëŸ¬ê·¸', 'ì¹´í˜íŠ¸', 'ì¿ ì…˜', 'ë°©ì„',
    'ì»¤íŠ¼', 'ì•”ë§‰ì»¤íŠ¼', 'ë¸”ë¼ì¸ë“œ',
    'ì¡°ëª…', 'ìŠ¤íƒ ë“œ', 'ë¬´ë“œë“±', 'ledì¡°ëª…',
    'ì•¡ì', 'í¬ìŠ¤í„°', 'ì›”ë°ì½”',
    'ë””í“¨ì €', 'í–¥ì´ˆ', 'ìº”ë“¤',
    'ë§ˆí¬ë¼ë©”', 'ê°€ëœë“œ',
  ],
  outdoor: [
    'ìº í•‘', 'ìº í•‘ì˜ì', 'ìº í•‘í…Œì´ë¸”', 'í´ë”©ì²´ì–´',
    'ì¹¨ë‚­', 'ì›í„°ì¹˜í…íŠ¸', 'ë”í…íŠ¸', 'íƒ€í”„', 'íƒ€í”„ì‰˜í„°',
    'ëœí„´', 'ìº í•‘ëœí„´', 'ë²„ë„ˆ', 'ì½”í ', 'ìº í•‘ì¿¨ëŸ¬',
    'ë“±ì‚°', 'ë“±ì‚°ìŠ¤í‹±', 'ë“±ì‚°í™”', 'ë°°ë‚­',
    'ìì „ê±°', 'mtb', 'ë¡œë“œìì „ê±°',
  ],
  cleaning: [
    'ì²­ì†Œí¬', 'ë¨¼ì§€ë–¨ì´', 'ë°€ëŒ€', 'ë¬¼ê±¸ë ˆ',
    'ë¹—ìë£¨', 'ì“°ë ˆë°›ê¸°', 'ë¹¨ë˜ë°”êµ¬ë‹ˆ',
    'ì„¸íƒì„¸ì œ', 'ì„¬ìœ ìœ ì—°ì œ', 'í‘œë°±ì œ',
    'ì£¼ë°©ì„¸ì œ', 'ì„¸íƒë§', 'ë°°ìˆ˜êµ¬í´ë¦¬ë„ˆ',
    'ê±¸ë ˆ', 'í–‰ì£¼',
  ],
  bedding: [
    'ì´ë¶ˆ', 'ì°¨ë µì´ë¶ˆ', 'í† í¼', 'íŒ¨ë“œ',
    'ë² ê°œ', 'ê¸°ëŠ¥ì„± ë² ê°œ', 'ê²½ì¶”ë² ê°œ',
    'ë§¤íŠ¸ë¦¬ìŠ¤', 'í† í¼ ë§¤íŠ¸ë¦¬ìŠ¤',
    'ì¹¨êµ¬ì„¸íŠ¸', 'í˜¸í…”ì¹¨êµ¬',
    'ì´ë¶ˆì»¤ë²„', 'ë² ê°œì»¤ë²„',
  ],
  food: [
    'ê°„í¸ì‹', 'ë°€í‚¤íŠ¸', 'ë„ì‹œë½',
    'ë¼ë©´', 'ì»µë¼ë©´', 'ê³¼ì', 'ìŠ¤ë‚µ',
    'ê²¬ê³¼ë¥˜', 'ì•„ëª¬ë“œ', 'í˜¸ë‘',
    'ì»¤í”¼', 'ë“œë¦½ë°±', 'ìº¡ìŠì»¤í”¼',
    'ìŒë£Œ', 'íƒ„ì‚°ìŒë£Œ', 'ì£¼ìŠ¤', 'ì°¨', 'í‹°ë°±',
    'ì‹œë¦¬ì–¼', 'ì˜¤íŠ¸ë°€', 'í”„ë¡œí‹´ë°”',
  ],
  office: [
    'ë³¼íœ', 'ì—°í•„', 'ìƒ¤í”„', 'í˜•ê´‘íœ',
    'ë…¸íŠ¸', 'ë‹¤ì´ì–´ë¦¬', 'í”Œë˜ë„ˆ',
    'íŒŒì¼', 'ë°”ì¸ë”', 'í´ë¦¬ì–´íŒŒì¼',
    'í”„ë¦°í„°ìš©ì§€', 'ë³µì‚¬ìš©ì§€', 'í¬ìŠ¤íŠ¸ì‡', 'ë©”ëª¨ì§€',
    'ìì„ë³´ë“œ', 'í™”ì´íŠ¸ë³´ë“œ', 'ë³´ë“œë§ˆì¹´',
  ],
  general: [],
};

// ---------------------------
// 4. ì¹´í…Œê³ ë¦¬ë³„ ì„¤ëª…ë¬¸ / FAQ í…œí”Œë¦¿
// ---------------------------

const EXPLANATION_TEMPLATES = {
  mobile: (k) =>
    `${k}ë¥¼ ê³ ë¥¼ ë•ŒëŠ” ë³´í˜¸ë ¥, ê·¸ë¦½ê°, ë‘ê»˜ì™€ ë¬´ê²Œë¥¼ í•¨ê»˜ ë¹„êµí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì¹´ë©”ë¼ ë²”í¼ ë†’ì´ì™€ ë¬´ì„ ì¶©ì „ í˜¸í™˜ ì—¬ë¶€ë„ ì²´í¬í•˜ë©´ ì‹¤ì œ ì‚¬ìš© ë§Œì¡±ë„ê°€ í›¨ì”¬ ë†’ì•„ì§‘ë‹ˆë‹¤.`,
  computer: (k) =>
    `${k}ëŠ” ì‚¬ìš© ëª©ì (ì‚¬ë¬´ìš©, ê²Œì„ìš©, ì˜ìƒ í¸ì§‘ìš©)ì— ë”°ë¼ í•„ìš”í•œ ì‚¬ì–‘ì´ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. CPU, ë©”ëª¨ë¦¬, ì €ì¥ì¥ì¹˜ë¿ ì•„ë‹ˆë¼ ë°œì—´ê³¼ ì†ŒìŒ, AS ì •ì±…ê¹Œì§€ í•¨ê»˜ í™•ì¸í•´ ë³´ì„¸ìš”.`,
  appliance: (k) =>
    `${k}ëŠ” ì†Œë¹„ì „ë ¥ê³¼ ì†ŒìŒ, ìœ ì§€ë¹„ë¥¼ í•¨ê»˜ ê³ ë ¤í•´ì„œ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. í•„í„° êµì²´ ì£¼ê¸°ë‚˜ ì¶”ê°€ ì†Œëª¨í’ˆ ë¹„ìš©, ì„¤ì¹˜ ê³µê°„ê¹Œì§€ ë¯¸ë¦¬ ì²´í¬í•˜ë©´ ì‹¤íŒ¨ í™•ë¥ ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
  kitchen: (k) =>
    `${k}ëŠ” ì¬ì§ˆê³¼ ì½”íŒ… ë°©ì‹ì— ë”°ë¼ ë‚´êµ¬ì„±ê³¼ ì‚¬ìš©ê°ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì¸ë•ì…˜ í˜¸í™˜ ì—¬ë¶€, ì†ì¡ì´ ë§ˆê°, ì„¸ì²™ í¸ì˜ì„±ì„ í•¨ê»˜ ë¹„êµí•´ ë³´ë©´ ì˜¤ë˜ ë§Œì¡±í•˜ë©° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
  baby: (k) =>
    `${k}ëŠ” ì•ˆì „ì„±ê³¼ ì„±ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•œ ì œí’ˆêµ°ì…ë‹ˆë‹¤. KC ì¸ì¦ ì—¬ë¶€ì™€ ì „ì„±ë¶„, í–¥Â·ìƒ‰ì†Œ ì²¨ê°€ ì—¬ë¶€ë¥¼ ê¼¼ê¼¼íˆ í™•ì¸í•˜ê³  ì‹¤ì œ ì‚¬ìš©ì í›„ê¸°ë¥¼ ì°¸ê³ í•´ ì„ íƒí•˜ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.`,
  beauty: (k) =>
    `${k}ëŠ” í”¼ë¶€ íƒ€ì…ê³¼ ê³„ì ˆì— ë”°ë¼ ì–´ìš¸ë¦¬ëŠ” ì œí’ˆì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì „ì„±ë¶„ê³¼ ë°œë¦¼ê°, ì§€ì†ë ¥, í–¥ì„ í•¨ê»˜ ë¹„êµí•´ ë³´ê³  í•„ìš”í•˜ë‹¤ë©´ ì†Œìš©ëŸ‰ ì œí’ˆìœ¼ë¡œ ë¨¼ì € í…ŒìŠ¤íŠ¸í•´ ë³´ëŠ” ê²ƒë„ ì¢‹ìŠµë‹ˆë‹¤.`,
  fitness: (k) =>
    `${k}ëŠ” ìì‹ ì˜ ìš´ë™ ê°•ë„ì™€ ì²´í˜•ì— ë§ê²Œ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë‘ê»˜ì™€ ì¿ ì…˜ê°, ë¯¸ë„ëŸ¼ ë°©ì§€ ì—¬ë¶€, ë³´ê´€ê³¼ ì´ë™ í¸ì˜ì„±ì„ í•¨ê»˜ ì‚´í´ë³´ë©´ ì‚¬ìš© ë§Œì¡±ë„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.`,
  auto: (k) =>
    `${k}ëŠ” ì°¨ëŸ‰ ëª¨ë¸ê³¼ ì‹¤ë‚´ ì¸í…Œë¦¬ì–´ ë¶„ìœ„ê¸°ì— ì–´ìš¸ë¦¬ëŠ”ì§€, ì„¤ì¹˜ ë°©ì‹ì´ ê°„í¸í•œì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ì—¬ë¦„Â·ê²¨ìš¸ ì˜¨ë„ ë³€í™”ì—ë„ ë²„í‹¸ ìˆ˜ ìˆëŠ” ë‚´êµ¬ì„±ê³¼ ê´€ë¦¬ í¸ì˜ì„±ë„ í•¨ê»˜ ë³´ì„¸ìš”.`,
  toy: (k) =>
    `${k}ëŠ” ì—°ë ¹ëŒ€ì— ë§ëŠ” ë‚œì´ë„ì™€ ì•ˆì „ì„±ì´ í•µì‹¬ì…ë‹ˆë‹¤. ì‘ì€ ë¶€í’ˆì´ ë§ì€ì§€, ì¡°ë¦½ ë‚œì´ë„ëŠ” ì–´ë–¤ì§€, ì•„ì´ê°€ í¥ë¯¸ë¥¼ ëŠë‚„ ë§Œí•œ í…Œë§ˆì¸ì§€ í•¨ê»˜ í™•ì¸í•´ ë³´ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.`,
  fashion: (k) =>
    `${k}ëŠ” ì²´í˜•ê³¼ í‰ì†Œ ìŠ¤íƒ€ì¼ì— ë§ëŠ” í•ì„ ê³ ë¥´ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì†Œì¬ ë‘ê»˜ì™€ íƒ„ì„±, ì„¸íƒ ë°©ë²•ì„ í™•ì¸í•˜ê³ , ë¦¬ë·° ì‚¬ì§„ì„ ì°¸ê³ í•˜ë©´ ì‹¤ì œ ì°©ìš© ì´ë¯¸ì§€ë¥¼ ë” ì‰½ê²Œ ê°€ëŠ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
  health: (k) =>
    `${k}ëŠ” ë³¸ì¸ì˜ ì»¨ë””ì…˜ê³¼ ê¸°ì¡´ì— ë³µìš© ì¤‘ì¸ ì˜ì–‘ì œì™€ì˜ ì¤‘ë³µ ì—¬ë¶€ë¥¼ ë¨¼ì € í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. 1ì¼ ê¶Œì¥ëŸ‰ê³¼ ì„­ì·¨ ì‹œê°„, í•¨ê»˜ ë¨¹ìœ¼ë©´ ì¢‹ì€ ì¡°í•©ê¹Œì§€ ì²´í¬í•´ ë³´ì„¸ìš”.`,
  pet: (k) =>
    `${k}ëŠ” ë°˜ë ¤ë™ë¬¼ì˜ ë‚˜ì´ì™€ ì²´ì¤‘, í™œë™ëŸ‰ì— ë§ê²Œ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤. ì£¼ì›ë£Œì™€ ì²¨ê°€ë¬¼, ì•Œë ˆë¥´ê¸° ìœ ë°œ ì„±ë¶„ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , ê¸‰ì—¬ í›„ ë°˜ì‘ì„ ê´€ì°°í•˜ë©´ì„œ ì²œì²œíˆ ëŠ˜ë ¤ê°€ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.`,
  furniture: (k) =>
    `${k}ëŠ” ì‹¤ì œ ë°© í¬ê¸°ì™€ ë™ì„ ì— ë§ëŠ” ì‚¬ì´ì¦ˆë¥¼ ë¨¼ì € í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì¬ì§ˆê³¼ ë§ˆê°, ì¡°ë¦½ ë‚œì´ë„ì™€ AS ê°€ëŠ¥ ì—¬ë¶€ê¹Œì§€ ì‚´í´ë³´ë©´ ì˜¤ë˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì„ íƒì— ë„ì›€ì´ ë©ë‹ˆë‹¤.`,
  interior: (k) =>
    `${k}ëŠ” ì§‘ì˜ ì „ì²´ ë¶„ìœ„ê¸°ì™€ ì˜ ì–´ìš¸ë¦¬ëŠ” ì»¬ëŸ¬ì™€ ì†Œì¬ë¥¼ ê³ ë¥´ëŠ” ê²ƒì´ í¬ì¸íŠ¸ì…ë‹ˆë‹¤. ê´€ë¦¬ ë‚œì´ë„ì™€ ê³„ì ˆê°ê¹Œì§€ ê³ ë ¤í•´ ì‘ì€ ì•„ì´í…œë¶€í„° ì²œì²œíˆ êµì²´í•´ ë³´ëŠ” ê²ƒë„ ì¢‹ìŠµë‹ˆë‹¤.`,
  outdoor: (k) =>
    `${k}ëŠ” ì‚¬ìš© í™˜ê²½(ìº í•‘, ì°¨ë°•, ë“±ì‚°)ì— ë”°ë¼ í•„ìš”í•œ ìŠ¤í™ì´ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ë°©ìˆ˜Â·ë°©í’ ì„±ëŠ¥ê³¼ ë¬´ê²Œ, ìˆ˜ë‚© ì‚¬ì´ì¦ˆë¥¼ í•¨ê»˜ ë¹„êµí•´ ë³´ë©´ ì‹¤ì œ ì•¼ì™¸ì—ì„œ ë” í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
  cleaning: (k) =>
    `${k}ëŠ” ì²­ì†Œí•´ì•¼ í•  ê³µê°„ê³¼ ì˜¤ì—¼ ì •ë„ì— ë§ê²Œ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì¬ì‚¬ìš© ì—¬ë¶€ì™€ ì‚¬ìš© í›„ ê´€ë¦¬ ë°©ë²•, í”¼ë¶€ ìê·¹ ì—¬ë¶€ê¹Œì§€ í•¨ê»˜ í™•ì¸í•´ ë³´ì„¸ìš”.`,
  bedding: (k) =>
    `${k}ëŠ” ì‚¬ìš©ìì˜ ìˆ˜ë©´ ìŠµê´€ê³¼ ê³„ì ˆì— ë”°ë¼ ì¬ì§ˆê³¼ ë‘ê»˜ë¥¼ ê³ ë¥´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì„¸íƒ í¸ì˜ì„±ê³¼ ì•Œë ˆë¥´ê¸° ìœ ë°œ ì—¬ë¶€ê¹Œì§€ ì²´í¬í•˜ë©´ ë” í¸ì•ˆí•œ ìˆ˜ë©´ í™˜ê²½ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
  food: (k) =>
    `${k}ëŠ” ìœ í†µê¸°í•œê³¼ ë³´ê´€ ë°©ë²•, 1íšŒ ì„­ì·¨ëŸ‰ì„ ë¨¼ì € í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. í‰ì†Œ ì‹ìŠµê´€ê³¼ ì•Œë ˆë¥´ê¸° ì—¬ë¶€ë¥¼ ê³ ë ¤í•˜ê³ , ë¦¬ë·°ë¥¼ í†µí•´ ë§›ê³¼ ê°„ì„ í•¨ê»˜ ì°¸ê³ í•˜ë©´ ì‹¤íŒ¨ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
  office: (k) =>
    `${k}ëŠ” ì‚¬ìš© ë¹ˆë„ì™€ ì‘ì—… ìŠ¤íƒ€ì¼ì— ë§ê²Œ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê·¸ë¦½ê°ê³¼ í•„ê¸°ê°, ìš©ì§€ í˜¸í™˜ì„± ë“±ì„ ë¹„êµí•´ ë³´ë©´ ì¥ì‹œê°„ ì‚¬ìš©ì—ë„ ëœ í”¼ë¡œí•œ ì œí’ˆì„ ê³ ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
  general: (k) =>
    `${k}ë¥¼ ì„ íƒí•  ë•ŒëŠ” ê°€ê²©ë¿ ì•„ë‹ˆë¼ í’ˆì§ˆ, ë¦¬ë·°, AS ì •ì±…ê¹Œì§€ í•¨ê»˜ ë¹„êµí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì‹¤ì œ ì‚¬ìš©ì í›„ê¸°ë¥¼ ì‚´í´ë³´ë©´ ì¥ë‹¨ì ì„ ë¹ ë¥´ê²Œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
};

const FAQ_TEMPLATES = {
  mobile: [
    {
      q: 'ì¼€ì´ìŠ¤ëŠ” ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ê³ ë¥´ëŠ” ê²Œ ì¢‹ë‚˜ìš”?',
      a: 'í•¸ë“œí° ë³´í˜¸ë ¥ì´ ê°€ì¥ ì¤‘ìš”í•˜ë¯€ë¡œ ëª¨ì„œë¦¬ ë³´í˜¸ êµ¬ì¡°ì™€ ì¹´ë©”ë¼ ë²”í¼ ë†’ì´ë¥¼ ë¨¼ì € í™•ì¸í•˜ì„¸ìš”. ê·¸ë¦½ê°ê³¼ ë¬´ê²Œ, ë¬´ì„ ì¶©ì „ í˜¸í™˜ ì—¬ë¶€ë„ í•¨ê»˜ ë³´ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.',
    },
    {
      q: 'ê°•í™”ìœ ë¦¬ í•„ë¦„ê³¼ ì¼ë°˜ í•„ë¦„ì˜ ì°¨ì´ê°€ ë­”ê°€ìš”?',
      a: 'ê°•í™”ìœ ë¦¬ëŠ” ì¶©ê²©ê³¼ ìŠ¤í¬ë˜ì¹˜ì— ê°•í•˜ì§€ë§Œ ë‘ê»˜ê°ì´ ìˆê³ , ì¼ë°˜ í•„ë¦„ì€ ì–‡ê³  ê°€ë²¼ìš´ ëŒ€ì‹  ë³´í˜¸ë ¥ì´ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ìŠµë‹ˆë‹¤. ì‚¬ìš© ìŠ¤íƒ€ì¼ì— ë§ê²Œ ì„ íƒí•˜ì„¸ìš”.',
    },
    {
      q: 'ì •í’ˆ ì•¡ì„¸ì„œë¦¬ë¥¼ ê¼­ ì¨ì•¼ í•˜ë‚˜ìš”?',
      a: 'ì¶©ì „ê¸°ë‚˜ ì¼€ì´ë¸”ëŠ” ì•ˆì „ì„ ìœ„í•´ ì¸ì¦ ì œí’ˆì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ê¼­ ì •í’ˆì´ ì•„ë‹ˆë”ë¼ë„ KC ì¸ì¦ ë“± ì•ˆì „ ì¸ì¦ ì—¬ë¶€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.',
    },
  ],
  computer: [
    {
      q: 'ì‚¬ë¬´ìš© ë…¸íŠ¸ë¶ì€ ì–´ë–¤ ì‚¬ì–‘ì´ ì ë‹¹í•œê°€ìš”?',
      a: 'ë¬¸ì„œ ì‘ì—…ê³¼ ì¸í„°ë„· ìœ„ì£¼ë¼ë©´ i5/16GB RAM/SSD 256GB ì •ë„ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤. í”„ë¡œê·¸ë¨ì„ ë§ì´ ë„ì›Œë‘ëŠ” í¸ì´ë¼ë©´ ë©”ëª¨ë¦¬ë¥¼ 16GB ì´ìƒìœ¼ë¡œ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.',
    },
    {
      q: 'ê²Œì´ë°ìš© ëª¨ë‹ˆí„°ëŠ” ë¬´ì—‡ì„ ë´ì•¼ í•˜ë‚˜ìš”?',
      a: 'ì£¼ë¡œ ì£¼ì‚¬ìœ¨(Hz)ê³¼ ì‘ë‹µì†ë„(ms)ë¥¼ ì²´í¬í•©ë‹ˆë‹¤. FPS ê²Œì„ ìœ„ì£¼ë¼ë©´ 144Hz ì´ìƒ ì œí’ˆì„ ì¶”ì²œí•˜ë©°, ê·¸ë˜í”½ ì‘ì—…ì´ ë§ë‹¤ë©´ ìƒ‰ì¬í˜„ìœ¨ë„ í•¨ê»˜ í™•ì¸í•˜ì„¸ìš”.',
    },
    {
      q: 'ë…¸íŠ¸ë¶ ê±°ì¹˜ëŒ€ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ê°€ ë­”ê°€ìš”?',
      a: 'ê±°ì¹˜ëŒ€ë¥¼ ì‚¬ìš©í•˜ë©´ í™”ë©´ ë†’ì´ê°€ ì˜¬ë¼ê°€ ëª©ê³¼ ì–´ê¹¨ì— ë¶€ë‹´ì´ ì¤„ì–´ë“¤ê³ , í•˜ë‹¨ í†µí’ì´ ì¢‹ì•„ì ¸ ë°œì—´ ê´€ë¦¬ì—ë„ ë„ì›€ì´ ë©ë‹ˆë‹¤.',
    },
  ],
  kitchen: [
    {
      q: 'í”„ë¼ì´íŒ¬ì€ ì–´ë–¤ ì¬ì§ˆì´ ì¢‹ë‚˜ìš”?',
      a: 'ìì£¼ ì‚¬ìš©í•˜ëŠ” ê°€ì •ìš©ì€ ì½”íŒ…íŒ¬ì´ í¸ë¦¬í•˜ì§€ë§Œ, ë‚´êµ¬ì„±ì„ ì¤‘ì‹œí•œë‹¤ë©´ ìŠ¤í…Œì¸ë¦¬ìŠ¤ë‚˜ ë¬´ì‡ íŒ¬ë„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¸ë•ì…˜ ì‚¬ìš© ì—¬ë¶€ì— ë”°ë¼ í˜¸í™˜ ê°€ëŠ¥í•œ ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”.',
    },
    {
      q: 'ì¸ë•ì…˜ ì‚¬ìš© ê°€ëŠ¥í•œì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
      a: 'ëŒ€ë¶€ë¶„ ë°”ë‹¥ì— ì¸ë•ì…˜ í‘œì‹œê°€ ìˆê±°ë‚˜ ìƒì„¸í˜ì´ì§€ì— IH í˜¸í™˜ ì—¬ë¶€ê°€ ì í˜€ ìˆìŠµë‹ˆë‹¤. ìì„±ì´ ìˆëŠ” í‰í‰í•œ ë°”ë‹¥ì˜ ì œí’ˆì´ë©´ ëŒ€ë¶€ë¶„ ì¸ë•ì…˜ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
    },
    {
      q: 'ë°€íìš©ê¸°ëŠ” ì–´ë–¤ ì ì„ ë³´ë©´ ì¢‹ë‚˜ìš”?',
      a: 'ì „ìë ˆì¸ì§€ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€, ëšœê»‘ ë°€íë ¥, ì¬ì§ˆ(BPA free ë“±)ì„ í™•ì¸í•˜ì„¸ìš”. ìŒ“ì•„ì„œ ë³´ê´€í•˜ê¸° ì‰¬ìš´ ê·œê²©ì¸ì§€ë„ ì¤‘ìš”í•©ë‹ˆë‹¤.',
    },
  ],
  toy: [
    {
      q: 'ë ˆê³ /ë¸”ë¡ ì œí’ˆì€ ëª‡ ì‚´ë¶€í„° ê°€ëŠ¥í•œê°€ìš”?',
      a: 'ì œí’ˆë§ˆë‹¤ ê¶Œì¥ ì—°ë ¹ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ìƒì„¸í˜ì´ì§€ì˜ ì—°ë ¹ í‘œê¸°ë¥¼ ê¼­ í™•ì¸í•˜ì„¸ìš”. ì‘ì€ ë¶€í’ˆì´ ë§ì€ ì œí’ˆì€ 8ì„¸ ì´ìƒ ê¶Œì¥ì¸ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.',
    },
    {
      q: 'ì¡°ë¦½ ë‚œì´ë„ëŠ” ì–´ë””ì„œ í™•ì¸í•  ìˆ˜ ìˆë‚˜ìš”?',
      a: 'ì¡°ê° ìˆ˜ì™€ ìƒí’ˆ ì„¤ëª…, ë¦¬ë·°ë¥¼ í†µí•´ ëŒ€ëµì ì¸ ë‚œì´ë„ë¥¼ ê°€ëŠ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ˆë³´ìë¼ë©´ ì¡°ê° ìˆ˜ê°€ ë„ˆë¬´ ë§ì€ ì œí’ˆì€ í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.',
    },
    {
      q: 'ì •í’ˆê³¼ í˜¸í™˜ ë¸”ë¡ì˜ ì°¨ì´ëŠ” ë­”ê°€ìš”?',
      a: 'ì •í’ˆì€ ê²°í•©ë ¥ê³¼ ë§ˆê° í€„ë¦¬í‹°ê°€ ì•ˆì •ì ì¸ í¸ì…ë‹ˆë‹¤. í˜¸í™˜ ë¸”ë¡ì€ ê°€ê²©ì´ ì €ë ´í•œ ëŒ€ì‹  ê²°í•©ê°ì´ë‚˜ ìƒ‰ê°ì—ì„œ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ë¦¬ë·°ë¥¼ ê¼­ í™•ì¸í•˜ì„¸ìš”.',
    },
  ],
  general: [
    {
      q: 'ì˜¨ë¼ì¸ìœ¼ë¡œ êµ¬ë§¤í•  ë•Œ ì–´ë–¤ ì ì„ ë¨¼ì € ë´ì•¼ í•˜ë‚˜ìš”?',
      a: 'ê°€ê²©ê³¼ í•¨ê»˜ ë¦¬ë·° ìˆ˜, í‰ì , ìµœê·¼ ë¦¬ë·° ë‚´ìš©ì„ ë¨¼ì € í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì‹¤ì œ ì‚¬ìš©ìì˜ ì‚¬ì§„ ë¦¬ë·°ê°€ ë§ì€ ì œí’ˆì„ ìš°ì„ ì ìœ¼ë¡œ ì‚´í´ë³´ì„¸ìš”.',
    },
    {
      q: 'êµí™˜Â·ë°˜í’ˆì€ ì–´ë–»ê²Œ í™•ì¸í•˜ë‚˜ìš”?',
      a: 'ìƒì„¸í˜ì´ì§€ í•˜ë‹¨ì˜ êµí™˜/ë°˜í’ˆ ì•ˆë‚´ë¥¼ í™•ì¸í•˜ê³ , ë‹¨ìˆœ ë³€ì‹¬ ì‹œì—ë„ ê°€ëŠ¥í•œì§€, ì™•ë³µ íƒë°°ë¹„ëŠ” ì–¼ë§ˆì¸ì§€ ë¯¸ë¦¬ í™•ì¸í•´ ë‘ë©´ ì¢‹ìŠµë‹ˆë‹¤.',
    },
    {
      q: 'ìµœì €ê°€ë§Œ ë³´ê³  ì„ íƒí•´ë„ ê´œì°®ì„ê¹Œìš”?',
      a: 'ë„ˆë¬´ ì €ë ´í•œ ìƒí’ˆì€ í’ˆì§ˆì´ë‚˜ ë°°ì†¡, ASì—ì„œ ì•„ì‰¬ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ê²©ê³¼ ë”ë¶ˆì–´ íŒë§¤ì ì‹ ë¢°ë„ì™€ ë¦¬ë·°ë¥¼ í•¨ê»˜ ë¹„êµí•´ ë³´ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.',
    },
  ],
};

// ---------------------------
// 5. ê·œì¹™ ê¸°ë°˜ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
// ---------------------------
function classifyCategory(keyword, products) {
  const textParts = [];
  if (keyword) textParts.push(keyword);

  if (Array.isArray(products)) {
    for (const p of products) {
      if (p.productName) textParts.push(p.productName);
      if (p.categoryName) textParts.push(p.categoryName);
    }
  }

  const text = textParts.join(' ').toLowerCase();

  let bestCategory = 'general';
  let bestScore = 0;

  for (const [cat, patterns] of Object.entries(CATEGORY_PATTERNS)) {
    if (!patterns || !patterns.length) continue;
    let score = 0;
    for (const pat of patterns) {
      const token = String(pat || '').toLowerCase();
      if (!token) continue;
      if (text.includes(token)) score++;
    }
    if (score > bestScore) {
      bestScore = score;
      bestCategory = cat;
    }
  }

  if (bestScore === 0) return 'general';
  return bestCategory;
}

// ---------------------------
// 6. HTML ì´ìŠ¤ì¼€ì´í”„
// ---------------------------
function escapeHtml(str) {
  return String(str || '')
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

// ---------------------------
// 7. Lambda Handler
// ---------------------------
exports.handler = async (event) => {
  try {
    // Netlify Blobs ì´ˆê¸°í™”
    connectLambda(event);

    // slug ê²°ì •: ?slug=... ìš°ì„ , ì—†ìœ¼ë©´ path ë§ˆì§€ë§‰ segment
    let slug =
      (event.queryStringParameters && event.queryStringParameters.slug) ||
      (event.path || '').split('/').pop();

    if (!slug || slug === 'livePost') {
      return {
        statusCode: 400,
        headers: { 'Content-Type': 'text/plain; charset=utf-8' },
        body: 'slug is required',
      };
    }

    const keyword = await getKeywordFromStore(slug);

    // ì¿ íŒ¡ API í˜¸ì¶œ
    const res = await coupang.searchProducts(keyword);

    if (!res || res.rCode !== '0') {
      throw new Error(
        `Coupang API error: ${res && (res.rMessage || res.message || res.rCode)
        }`,
      );
    }

    const products = (res.data && res.data.productData) || [];
    if (!Array.isArray(products) || products.length === 0) {
      throw new Error('ìƒí’ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    const firstImage = products[0]?.productImage || '';
    const baseUrl = process.env.URL || 'https://icbhplus.com';
    const canonicalUrl = `${baseUrl.replace(/\/+$/, '')}/live/${encodeURIComponent(
      slug,
    )}`;

    const pageTitle = `${keyword} ì¶”ì²œ TOP10 Â· ì¿ íŒ¡ ì¸ê¸°ìƒí’ˆ ë¦¬ìŠ¤íŠ¸`;
    const metaDescription = `${keyword} ê´€ë ¨ ìµœì‹  ì¸ê¸° ìƒí’ˆ TOP10ì„ ì¿ íŒ¡ API ê¸°ë°˜ìœ¼ë¡œ ìë™ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. ê°€ê²©, ë°°ì†¡, ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ í•œëˆˆì— ë¹„êµí•´ ë³´ì„¸ìš”.`;

    const relatedKeywords = generateRelatedKeywords(keyword);
    const metaKeywords = relatedKeywords.join(', ').replace(/"/g, "'");

    // ì¹´í…Œê³ ë¦¬ ìë™ ë¶„ë¥˜
    const category = classifyCategory(keyword, products);

    // ì„¤ëª…ë¬¸/FAQ ìƒì„±
    const explanationFn =
      EXPLANATION_TEMPLATES[category] || EXPLANATION_TEMPLATES.general;
    const explanation = explanationFn(keyword);

    const faqs =
      FAQ_TEMPLATES[category] ||
      FAQ_TEMPLATES.general ||
      [
        {
          q: `${keyword}ëŠ” ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ê³ ë¥´ë©´ ì¢‹ì„ê¹Œìš”?`,
          a: 'ì˜ˆì‚°ì„ ì •í•œ ë’¤ ì£¼ìš” ìŠ¤í™ê³¼ ì‹¤ì œ ì‚¬ìš©ì ë¦¬ë·°ë¥¼ í•¨ê»˜ ë¹„êµí•´ ë³´ì‹œëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.',
        },
        {
          q: `êµ¬ë§¤ ì „ ê¼­ í™•ì¸í•´ì•¼ í•  ì ì´ ìˆë‚˜ìš”?`,
          a: 'ë°°ì†¡ ì˜µì…˜, êµí™˜Â·ë°˜í’ˆ ì •ì±…, AS ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë¯¸ë¦¬ í™•ì¸í•´ ë‘ë©´ ì˜ˆìƒì¹˜ ëª»í•œ ë¶ˆí¸ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        },
        {
          q: `ì˜¨ë¼ì¸ êµ¬ë§¤ê°€ ì˜¤í”„ë¼ì¸ë³´ë‹¤ ë¶ˆë¦¬í•˜ì§„ ì•Šë‚˜ìš”?`,
          a: 'ìƒì„¸ ì‚¬ì§„ê³¼ ë¦¬ë·°ë¥¼ ì¶©ë¶„íˆ í™•ì¸í•˜ê³ , ì‹ ë¢°ë„ ë†’ì€ íŒë§¤ìë¥¼ ì„ íƒí•˜ë©´ ì˜¤í”„ë¼ì¸ë³´ë‹¤ ë” í¸ë¦¬í•˜ê²Œ êµ¬ë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        },
      ];

    // ìƒí’ˆ ì¹´ë“œ HTML
    const itemsHtml = products
      .map((p, idx) => {
        const name = p.productName || 'ìƒí’ˆëª… ì—†ìŒ';
        const url = p.productUrl || '#';
        const image = p.productImage || '';
        const rank = p.rank || idx + 1;
        const priceNum =
          typeof p.productPrice === 'number'
            ? p.productPrice
            : Number(p.productPrice || 0);
        const priceTxt = priceNum ? `${priceNum.toLocaleString()}ì›` : '';
        const isRocket = p.isRocket;
        const isFree = p.isFreeShipping;
        const categoryName = p.categoryName || '';

        return `
        <a class="card" href="${url}" target="_blank" rel="nofollow noopener">
          <div class="thumb">
            ${image
            ? `<img src="${image}" alt="${escapeHtml(
              name,
            )}" loading="lazy">`
            : ''
          }
          </div>
          <div class="info">
            <div class="rank">TOP ${rank}</div>
            <h2 class="title">${escapeHtml(name)}</h2>
            ${priceTxt ? `<p class="price">${priceTxt}</p>` : ''}
            <p class="meta">
              ${isRocket ? 'ğŸš€ ë¡œì¼“ë°°ì†¡' : 'ğŸ“¦ ì¼ë°˜ë°°ì†¡'}
              ${isFree ? ' Â· ë¬´ë£Œë°°ì†¡ ê°€ëŠ¥' : ''}
              ${categoryName ? ` Â· ${escapeHtml(categoryName)}` : ''}
            </p>
            <div class="btn-like">ì¿ íŒ¡ì—ì„œ ìƒì„¸ë³´ê¸° â†—</div>
          </div>
        </a>
      `;
      })
      .join('');

    // íƒœê·¸ / ì„¤ëª… / FAQ ì„¹ì…˜
    const tagsHtml = relatedKeywords.length
      ? `
      <section class="tags" aria-label="${escapeHtml(keyword)} ì—°ê´€ í‚¤ì›Œë“œ">
        <h2 class="section-title">ì—°ê´€ í‚¤ì›Œë“œ Â· í•´ì‹œíƒœê·¸</h2>
        <div class="tag-list">
          ${relatedKeywords
        .map((t) => `<span class="tag">#${escapeHtml(t)}</span>`)
        .join(' ')}
        </div>
      </section>
    `
      : '';

    const explanationHtml = `
      <section class="explain" aria-label="${escapeHtml(
      keyword,
    )} ì‡¼í•‘ ê°€ì´ë“œ">
        <h2 class="section-title">êµ¬ë§¤ ì „ ê°„ë‹¨ ì²´í¬í¬ì¸íŠ¸</h2>
        <p>${escapeHtml(explanation)}</p>
      </section>
    `;

    const faqHtml = `
      <section class="faq" aria-label="${escapeHtml(keyword)} ìì£¼ ë¬»ëŠ” ì§ˆë¬¸">
        <h2 class="section-title">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸(FAQ)</h2>
        <ul>
          ${faqs
        .slice(0, 3)
        .map(
          (f) => `
            <li>
              <strong>${escapeHtml(f.q)}</strong><br>
              <span>${escapeHtml(f.a)}</span>
            </li>
          `,
        )
        .join('')}
        </ul>
      </section>
    `;

    // ìµœì¢… HTML
    const html = `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>${escapeHtml(pageTitle)}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="${escapeHtml(metaDescription)}">
  ${metaKeywords
        ? `<meta name="keywords" content="${escapeHtml(metaKeywords)}">`
        : ''
      }
  <link rel="canonical" href="${escapeHtml(canonicalUrl)}">
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="${escapeHtml(pageTitle)}">
  <meta property="og:description" content="${escapeHtml(metaDescription)}">
  <meta property="og:url" content="${escapeHtml(canonicalUrl)}">
  ${firstImage ? `<meta property="og:image" content="${firstImage}">` : ''}
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="${escapeHtml(pageTitle)}">
  <meta name="twitter:description" content="${escapeHtml(metaDescription)}">
  ${firstImage ? `<meta name="twitter:image" content="${firstImage}">` : ''}
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 26px 18px 32px;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background:
        radial-gradient(circle at top, #1e293b 0, #020617 55%),
        radial-gradient(circle at 120% 120%, #0f172a 0, #020617 60%);
      color: #e5e7eb;
    }
    @media (min-width: 960px) {
      body { padding: 32px 24px 40px; }
    }
    .wrap { max-width: 1080px; margin: 0 auto; }
    header { margin-bottom: 22px; }
    h1 {
      margin: 0 0 8px;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: -0.03em;
      background: linear-gradient(135deg, #60a5fa, #a855f7);
      -webkit-background-clip: text;
      color: transparent;
    }
    p.sub {
      margin: 0;
      font-size: 14px;
      color: #94a3b8;
    }

    .section-title {
      margin: 18px 0 10px;
      font-size: 16px;
      color: #cbd5e1;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 18px;
    }

    .card {
      display: flex;
      flex-direction: column;
      padding: 14px;
      border-radius: 20px;
      text-decoration: none;
      color: inherit;
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.65), rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(148, 163, 253, 0.55);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 22px 55px rgba(15, 23, 42, 1);
      border-color: #38bdf8;
    }

    .thumb {
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 16px;
      overflow: hidden;
      background: #020617;
      margin-bottom: 10px;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
      min-height: 110px;
    }
    .rank {
      font-size: 11px;
      color: #a5b4fc;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .title {
      margin: 0;
      font-size: 14px;
      font-weight: 500;
      color: #e5e7eb;
      line-height: 1.4;
    }
    .price {
      margin: 4px 0 2px;
      font-size: 14px;
      color: #fb923c;
      font-weight: 600;
    }
    .meta {
      margin: 0;
      font-size: 12px;
      color: #cbd5e1;
    }
    .btn-like {
      margin-top: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: linear-gradient(135deg, #6366f1, #38bdf8);
      color: #f9fafb;
      box-shadow: 0 12px 28px rgba(56, 189, 248, 0.5);
    }

    .explain, .faq, .tags {
      margin-top: 22px;
      padding: 16px 14px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,253,0.35);
      background: rgba(15,23,42,0.9);
      box-shadow: 0 14px 32px rgba(15,23,42,0.9);
      font-size: 13px;
      color: #cbd5e1;
    }
    .explain p {
      margin: 0 0 8px;
      line-height: 1.6;
    }

    .tags {
      padding-bottom: 12px;
    }
    .tag-list {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .tag {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 253, 0.45);
      color: #cbd5e1;
    }

    .faq ul {
      margin: 4px 0 0;
      padding-left: 18px;
    }
    .faq li {
      margin-bottom: 6px;
    }

    footer {
      margin-top: 24px;
      font-size: 12px;
      color: #94a3b8;
    }
    .back {
      display: inline-block;
      margin-bottom: 8px;
      font-size: 13px;
      color: #cbd5e1;
      text-decoration: none;
      opacity: 0.85;
    }
    .back:hover {
      opacity: 1;
      text-decoration: underline;
    }

    @media (max-width: 640px) {
      .grid {
        grid-template-columns: 1fr;
      }
      .explain, .faq, .tags {
        padding: 14px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>${escapeHtml(keyword)} ì¶”ì²œ TOP10 Â· ì¿ íŒ¡ ì¸ê¸°ìƒí’ˆ</h1>
      <p class="sub">ì•„ë˜ ì¹´ë“œ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ì¿ íŒ¡ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ìœ¼ë¡œ ì¼ì • ìˆ˜ìˆ˜ë£Œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </header>

    <main>
      <h2 class="section-title">${escapeHtml(
        keyword,
      )} ì¶”ì²œ ìƒí’ˆ í•œëˆˆì— ë³´ê¸°</h2>
      <section class="grid" aria-label="${escapeHtml(
        keyword,
      )} ì¶”ì²œ ìƒí’ˆ ëª©ë¡">
        ${itemsHtml}
      </section>

      ${explanationHtml}
      ${tagsHtml}
      ${faqHtml}
    </main>

    <footer>
      <a class="back" href="/">â† ë‹¤ë¥¸ í‚¤ì›Œë“œ ë³´ëŸ¬ê°€ê¸°</a>
      <div>â€» ì´ í˜ì´ì§€ëŠ” ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì¼ì • ìˆ˜ìˆ˜ë£Œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </footer>
  </div>
</body>
</html>`;

    return {
      statusCode: 200,
      headers: { 'Content-Type': 'text/html; charset=utf-8' },
      body: html,
    };
  } catch (e) {
    console.error(e);
    return {
      statusCode: 500,
      headers: { 'Content-Type': 'text/plain; charset=utf-8' },
      body: `ERROR:\n${e && e.stack ? e.stack : e}`,
    };
  }
};
